<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}KAi Experiments{% endblock %}</title>

  <!-- HTMX 2.x â€” server-driven partial updates -->
  <script src="https://unpkg.com/htmx.org@2.0.4" defer></script>
  <!-- Alpine.js 3.x â€” lightweight client-side reactivity -->
  <script src="https://unpkg.com/alpinejs@3.14.9/dist/cdn.min.js" defer></script>

  <style>
    /* â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* â”€â”€ CSS design-system tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --bg:          #0f1117;
      --surface:     #1a1d27;
      --surface-2:   #23273a;
      --border:      #2e3350;
      --accent:      #7c6af7;
      --accent-dim:  #5a4fd6;
      --accent-glow: rgba(124, 106, 247, 0.15);
      --text:        #e2e4f0;
      --text-muted:  #7b82a8;
      --user-bubble: #2c3a6e;
      --ai-bubble:   #1e2235;
      --danger:      #e74c4c;
      --success:     #4caf7c;
      --warning:     #f0a63a;
      --radius:      12px;
      --radius-sm:   6px;
      --radius-lg:   16px;
      --font:        'Inter', system-ui, sans-serif;
      --mono:        'JetBrains Mono', 'Fira Code', monospace;
    }

    /* â”€â”€ Base typography & page â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    html, body {
      height: 100%;
      background-color: var(--bg);
      color: var(--text);
      font-family: var(--font);
      font-size: 16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* â”€â”€ App shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app-shell {
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* â”€â”€ Top navigation bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .topnav {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 0 20px;
      height: 52px;
      min-height: 52px;
      background-color: var(--surface);
      border-bottom: 1px solid var(--border);
      z-index: 100;
    }
    .topnav__brand { display: flex; align-items: center; gap: 10px; margin-right: 24px; }
    .topnav__logo  { font-size: 1.35rem; }
    .topnav__title { font-size: 0.95rem; font-weight: 700; color: var(--text); letter-spacing: 0.02em; }
    .topnav__links { display: flex; gap: 4px; flex: 1; }
    .topnav__link {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 6px 14px; border-radius: var(--radius-sm);
      color: var(--text-muted); text-decoration: none;
      font-size: 0.85rem; font-weight: 500;
      transition: background 0.15s, color 0.15s; cursor: pointer;
    }
    .topnav__link:hover { background-color: var(--surface-2); color: var(--text); }
    .topnav__link--active {
      background-color: var(--surface-2); color: var(--text);
      box-shadow: inset 0 -2px 0 var(--accent);
    }

    /* â”€â”€ Content area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app-content {
      flex: 1; display: flex; overflow: hidden; min-height: 0;
    }

    /* â”€â”€ Spinner overlay (shared) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .spinner-overlay {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background-color: rgba(15, 17, 23, 0.4);
      z-index: 50; display: flex; align-items: center; justify-content: center;
    }
    .spinner-overlay.htmx-request { display: flex !important; }
    .spinner {
      width: 36px; height: 36px;
      border: 3px solid var(--border); border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }

    /* â”€â”€ Common button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 8px 18px; border-radius: var(--radius); border: none;
      font-size: 0.85rem; font-weight: 600; cursor: pointer;
      transition: background 0.15s, opacity 0.15s; white-space: nowrap;
    }
    .btn--primary { background-color: var(--accent); color: #fff; }
    .btn--primary:hover { background-color: var(--accent-dim); }
    .btn--ghost { background-color: transparent; color: var(--text-muted); }
    .btn--ghost:hover { background-color: var(--surface-2); color: var(--text); }

    /* â”€â”€ Common input â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input {
      padding: 10px 14px; background-color: var(--surface-2);
      color: var(--text); border: 1px solid var(--border); border-radius: var(--radius);
      font-family: var(--font); font-size: 0.875rem; line-height: 1.5;
      transition: border-color 0.15s;
    }
    .input:focus  { outline: none; border-color: var(--accent); }
    .input:disabled { opacity: 0.5; cursor: not-allowed; }

    /* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background-color: transparent; }
    ::-webkit-scrollbar-thumb { background-color: var(--border); border-radius: 3px; }

    /* â”€â”€ Keyframes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes blink {
      0%, 80%, 100% { opacity: 0.2; transform: scale(1); }
      40%           { opacity: 1;   transform: scale(1.15); }
    }

    /* â”€â”€ Chat feature CSS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-root {
      display: flex; flex: 1; overflow: hidden; min-height: 0;
    }

    /* Sidebar */
    .sidebar {
      width: 260px; min-width: 260px; display: flex; flex-direction: column;
      background-color: var(--surface); border-right: 1px solid var(--border);
      transition: width 0.25s, min-width 0.25s; overflow: hidden;
    }
    .sidebar--collapsed { width: 0; min-width: 0; }
    .sidebar__header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 16px; border-bottom: 1px solid var(--border);
    }
    .sidebar__title { font-size: 0.875rem; font-weight: 600; color: var(--text); }
    .sidebar__toggle {
      background: none; border: none; color: var(--text-muted); cursor: pointer;
      padding: 4px 8px; border-radius: var(--radius-sm); font-size: 1rem;
      transition: background 0.15s, color 0.15s;
    }
    .sidebar__toggle:hover { background-color: var(--surface-2); color: var(--text); }
    .sidebar__new-btn {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      margin: 12px; padding: 10px; border-radius: var(--radius);
      background-color: var(--accent-glow); border: 1px dashed var(--accent);
      color: var(--accent); font-size: 0.85rem; font-weight: 600;
      cursor: pointer; transition: background 0.15s;
    }
    .sidebar__new-btn:hover { background-color: rgba(124,106,247,0.25); }
    .sidebar__list { flex: 1; overflow-y: auto; padding: 8px; display: flex; flex-direction: column; gap: 2px; }
    .sidebar__item {
      display: flex; align-items: center; gap: 10px; padding: 10px 12px;
      border-radius: var(--radius-sm); color: var(--text-muted);
      text-decoration: none; font-size: 0.85rem; cursor: pointer;
      transition: background 0.15s, color 0.15s;
    }
    .sidebar__item:hover { background-color: var(--surface-2); color: var(--text); }
    .sidebar__item--active { background-color: var(--accent-glow); color: var(--accent); }
    .sidebar__item-title { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    /* Chat main */
    .chat-main {
      flex: 1; display: flex; flex-direction: column; overflow: hidden; min-height: 0;
      position: relative;
    }
    .chat-main__content { flex: 1; display: flex; flex-direction: column; overflow: hidden; min-height: 0; }
    .chat {
      display: flex; flex-direction: column; flex: 1; overflow: hidden; min-height: 0;
    }
    .chat__header {
      display: flex; align-items: center; gap: 12px;
      padding: 14px 24px; border-bottom: 1px solid var(--border);
      background-color: var(--surface); min-height: 56px;
    }
    .chat__title { font-size: 0.95rem; font-weight: 600; color: var(--text); flex: 1; }
    .chat__title--placeholder { color: var(--text-muted); font-weight: 400; }
    .chat__model {
      font-size: 0.75rem; color: var(--text-muted);
      background-color: var(--surface-2); padding: 3px 8px; border-radius: 20px;
    }
    .chat__messages {
      flex: 1; overflow-y: auto; padding: 24px 32px;
      display: flex; flex-direction: column; gap: 16px;
    }
    .chat__empty {
      flex: 1; display: flex; align-items: center; justify-content: center;
      color: var(--text-muted); font-size: 0.95rem;
    }

    /* Messages */
    .message {
      display: flex; flex-direction: column; max-width: 72%;
      animation: fadeUp 0.2s ease;
    }
    .message--user  { align-self: flex-end;  align-items: flex-end; }
    .message--assistant { align-self: flex-start; align-items: flex-start; }
    .message__bubble {
      padding: 12px 16px; border-radius: var(--radius);
      line-height: 1.55; font-size: 0.9rem; white-space: pre-wrap; word-break: break-word;
    }
    .message--user .message__bubble {
      background-color: var(--user-bubble); border-bottom-right-radius: 4px;
    }
    .message--assistant .message__bubble {
      background-color: var(--ai-bubble); border: 1px solid var(--border); border-bottom-left-radius: 4px;
    }
    .message--error .message__bubble {
      background-color: rgba(231,76,76,0.15); border: 1px solid var(--danger); color: var(--danger);
    }
    .message__meta { font-size: 0.72rem; color: var(--text-muted); margin-top: 4px; }

    /* Typing indicator */
    .message--typing .message__bubble {
      display: flex; gap: 6px; align-items: center; padding: 14px 18px;
    }
    .typing-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background-color: var(--text-muted); animation: blink 1.2s infinite;
    }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    /* Input area */
    .chat__input-area {
      display: flex; gap: 10px; padding: 16px 24px;
      border-top: 1px solid var(--border); background-color: var(--surface);
    }
    .chat__textarea {
      flex: 1; resize: none; padding: 10px 14px;
      background-color: var(--surface-2); color: var(--text);
      border: 1px solid var(--border); border-radius: var(--radius);
      font-family: var(--font); font-size: 0.875rem; line-height: 1.5;
      transition: border-color 0.15s;
    }
    .chat__textarea:focus { outline: none; border-color: var(--accent); }
    .chat__textarea:disabled { opacity: 0.5; cursor: not-allowed; }
    .chat__send-btn {
      padding: 0 22px; background-color: var(--accent); color: #fff; border: none;
      border-radius: var(--radius); font-size: 0.875rem; font-weight: 600;
      cursor: pointer; transition: background 0.15s, opacity 0.15s; white-space: nowrap;
    }
    .chat__send-btn:hover:not(:disabled) { background-color: var(--accent-dim); }
    .chat__send-btn--disabled { opacity: 0.45; cursor: not-allowed; }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- â”€â”€ Top navigation bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <nav class="topnav">
      <div class="topnav__brand">
        <span class="topnav__logo">ðŸ§ª</span>
        <span class="topnav__title">KAi Experiments</span>
      </div>
      <div class="topnav__links">
        <a href="/" class="topnav__link {% block nav_active %}{% endblock %}">ðŸ’¬ Chat</a>
      </div>
    </nav>

    <!-- â”€â”€ Feature content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <main class="app-content">
      {% block content %}{% endblock %}
    </main>
  </div>
</body>
</html>
