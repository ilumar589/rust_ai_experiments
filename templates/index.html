{% extends "base.html" %}

{% block title %}KAi Experiments â€” Ollama Chat{% endblock %}
{% block nav_active %}topnav__link--active{% endblock %}

{% block content %}
<!-- Alpine root â€” owns shared chat state -->
<div class="chat-root" x-data='{ sidebarOpen: true, globalLoading: false }'>

  <!-- â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <aside class="sidebar" :class="{ 'sidebar--collapsed': !sidebarOpen }">
    <div class="sidebar__header">
      <span class="sidebar__title">ðŸ’¬ Conversations</span>
      <button class="sidebar__toggle" @click="sidebarOpen = !sidebarOpen" title="Toggle sidebar">
        <span>â‡„</span>
      </button>
    </div>

    <button class="sidebar__new-btn"
      hx-get="/chat/new"
      hx-target="#chat-panel"
      hx-swap="innerHTML"
      hx-indicator="#global-spinner">
      ï¼‹ New conversation
    </button>

    <nav class="sidebar__list" id="conversation-list">
      {% for conv in conversations %}
        <a class="sidebar__item{% if active_conversation_id == conv.id %} sidebar__item--active{% endif %}"
           href="#"
           hx-get="/chat/{{ conv.id }}"
           hx-target="#chat-panel"
           hx-swap="innerHTML"
           hx-push-url="false"
           hx-indicator="#global-spinner">
          <span class="sidebar__item-title">{{ conv.title }}</span>
        </a>
      {% endfor %}
    </nav>
  </aside>

  <!-- â”€â”€ Chat main area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="chat-main">
    <!-- Global loading spinner (shown via hx-indicator) -->
    <div class="spinner-overlay" id="global-spinner" style="display:none">
      <div class="spinner"></div>
    </div>

    <div class="chat-main__content" id="chat-panel">
      {% include "chat_panel.html" %}
    </div>
  </div>

</div>
{% endblock %}
